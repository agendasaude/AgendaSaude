<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pesquisa - AgendaSaúde</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header>
        <a href="inicio.php" class="logo">AgendaSaúde</a>
        <nav>
            <a href="tipoconta.php"><i class="fas fa-user-plus"></i> Cadastro</a> 
            <a href="login.html"><i class="fas fa-sign-in-alt"></i> Login</a>
        </nav>
    </header>
    
    <div class="container">
        <h1><i class="fas fa-search"></i> Pesquisar Médicos e Clínicas</h1>
        <div class="form-container" style="max-width: 700px; margin: 30px auto;">
            <div class="form-group">
                <input type="text" id="search-query" placeholder="Digite um termo aqui">
            </div>
            <button id="search-button" class="btn">Buscar</button>
        </div>
        <div id="feedback-message" class="feedback-message" style="display: none;"></div>
        <div class="agendamento-section" id="resultados-container">
            <h2>Resultados da Pesquisa:</h2>
            <div id="resultados-div">
                <p class="feedback-message info">Use a barra de busca acima para encontrar médicos ou clínicas</p>
            </div>
        </div>
    </div>

    <footer>
        &copy; 2025 ©AgendaSaúde. Todos os direitos reservados.
    </footer>

    <script>
        // Função utilitária para exibir feedback
        function showFeedback(message, type) {
            const messageDiv = document.getElementById('feedback-message');
            messageDiv.textContent = message;
            messageDiv.className = `feedback-message ${type}-message`; 
            messageDiv.style.display = 'block';
            setTimeout(() => {
                messageDiv.style.display = 'none'; }, 5000);
        }
        document.getElementById('search-button').addEventListener('click', function() {
            const query = document.getElementById('search-query').value.trim();
            const resultadosDiv = document.getElementById('resultados-div');
            resultadosDiv.innerHTML = '';
            showFeedback('', ''); // Limpa mensagens anteriores
            if (query.length >= 3) {
                // Acessa o backend PHP para buscar resultados
                fetch(`buscar.php?q=${encodeURIComponent(query)}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        } return response.json();
                    }) .then(data => {
                        let htmlOutput = '';
                        let totalCount = 0;

                        // Resultados de Médicos
                        if (data.medicos && data.medicos.length > 0) {
                            totalCount += data.medicos.length;
                            htmlOutput += '<h3>Médicos Encontrados:</h3><ul class="agendamentos-list">';
                            data.medicos.forEach(medico => {
                                htmlOutput += ` <li> <span> <i class="fas fa-user-md"></i> **${medico.nome}** - ${medico.especialidade} (Clínica: ${medico.clinica} </span> <a href="calendario.php" class="btn btn-secondary">Agendar</a> </li> `;
                            });
                            htmlOutput += '</ul>';
                        }

                        // Resultados de Clínicas
                        if (data.clinicas && data.clinicas.length > 0) {
                            totalCount += data.clinicas.length;
                            htmlOutput += '<h3>Clínicas Encontradas:</h3><ul class="agendamentos-list">';
                            data.clinicas.forEach(clinica => {
                                htmlOutput += ` <li> <span> <i class="fas fa-hospital"></i> **${clinica.nome}** - Especialidades: ${clinica.especialidades} </span> </li> `;
                            });
                            htmlOutput += '</ul>';
                        } if (totalCount === 0) {
                            htmlOutput = '<p class="feedback-message info-message">Nenhum resultado encontrado para sua pesquisa.</p>';
                        } resultadosDiv.innerHTML = htmlOutput;
                    }) .catch(error => {
                        showFeedback('Erro ao carregar resultados. Tente novamente mais tarde.', 'error');
                        console.error('Erro na busca:', error);
                    });
            } else {
                showFeedback('Digite pelo menos 3 caracteres para buscar.', 'warning');
            }
        });
    </script>
</body>
</html>